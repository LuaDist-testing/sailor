/*
 * Moonshine - a Lua virtual machine.
 *
 * Email: moonshine@gamesys.co.uk
 * http://moonshinejs.org
 *
 * Copyright (c) 2013-2015 Gamesys Limited. All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
 * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
 * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

!function(shine){function jsToLua(obj){var t,mt;return mt=new shine.Table({__index:function(t,key){var property=obj[key],i,children,child;if("function"==typeof property||property&&property.prototype&&"function"==typeof property.prototype.constructor){var f=function(){var e=convertArguments(arguments,luaToJS),t=property.apply(e.shift(),e);return"object"==typeof t?jsToLua(t):[t]};if(Object.getOwnPropertyNames)for(children=Object.getOwnPropertyNames(property),i=0;child=children[i];i++)"caller"!=child&&"callee"!=child&&"arguments"!=child&&(f[child]=property[child]);return f["new"]=function(){var args=convertArguments(arguments,luaToJS),argStr,obj,i,l;for(argStr=(l=args.length)?"args[0]":"",i=1;l>i;i++)argStr+=",args["+i+"]";return obj=eval("new property("+argStr+")"),jsToLua(obj)},f}return"object"==typeof property?jsToLua(property):property},__newindex:function(e,t,r){obj[t]=luaToJS(r)}}),mt.source=obj,t=new shine.Table,shine.gc.incrRef(t),shine.lib.setmetatable(t,mt)}function luaToJS(e){var t;if(e instanceof shine.Function)return function(){return jsToLua(e.apply(void 0,convertArguments(arguments,jsToLua)))};if(e instanceof shine.Table){if((t=shine.lib.getmetatable(e))&&t.source)return t.source;var r,n=shine.lib.table.getn(e)>0,o=shine.gc["create"+(n?"Array":"Object")](),i=e.__shine.numValues,a=i.length;for(r=1;a>r;r++)o[r-1]=(i[r]||shine.EMPTY_OBJ)instanceof shine.Table?luaToJS(i[r]):i[r];for(r in e)!e.hasOwnProperty(r)||r in shine.Table.prototype||"__shine"===r||(o[r]=(e[r]||shine.EMPTY_OBJ)instanceof shine.Table?luaToJS(e[r]):e[r]);return o}return"object"==typeof e?shine.utils.toObject(e):e}function convertArguments(e,t){var r,n,o=[];for(r=0,n=e.length;n>r;r++)o.push(t(e[r]));return o}shine.DOMAPI={window:jsToLua(window)},shine.DOMAPI.window.extract=function(){var e=shine.getCurrentVM(),t=Object.getOwnPropertyNames&&Object.getOwnPropertyNames(window);for(var r in t||window)t&&(r=t[r]),"print"!==r&&"window"!==r&&null!==window[r]&&e.setGlobal(r,shine.DOMAPI.window.getMember(r))}}(shine||{});
